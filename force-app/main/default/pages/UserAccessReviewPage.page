<apex:page controller="CertificationPageController" showHeader="true" sidebar="false">
    <apex:form >
        <script>
            // Remove token from URL after page loads
            if (window.location.search.includes('token=')) {
                history.replaceState({}, document.title, window.location.pathname);
            }
        </script>
        <apex:pageMessages id="messages" />
        <apex:pageBlock title="Certify Reportees for {!managerName}">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Bulk Certify" action="{!bulkCertify}" rerender="reporteeTable, messages" />
                <apex:commandButton value="Bulk Uncertify" action="{!bulkUncertify}" rerender="reporteeTable, messages" />
            </apex:pageBlockButtons>

            <apex:pageBlockTable value="{!reportees}" var="reportee" id="reporteeTable">
                <apex:column >
                    <apex:inputCheckbox value="{!selectedReporteeIds[reportee.Id]}" disabled="{!reportee.Certification_Status__c != 'Pending'}" />
                </apex:column>
                <apex:column value="{!reportee.First_Name__c}" headerValue="First Name" />
                <apex:column value="{!reportee.Last_Name__c}" headerValue="Last Name" />
                <apex:column value="{!reportee.Federation_Identifier__c}" headerValue="Federation Identifier" />
                <apex:column value="{!reportee.Att_Email__c}" headerValue="ATT Email" />
                <apex:column headerValue="Actions">
                    <apex:commandButton value="Keep Access" action="{!certifySingle}" rerender="reporteeTable, messages" disabled="{!reportee.Certification_Status__c != 'Pending'}">
                        <apex:param name="recordId" value="{!reportee.Id}" assignTo="{!selectedRecordId}" />
                    </apex:commandButton>
                    <apex:commandButton value="Remove Access" action="{!uncertifySingle}" rerender="reporteeTable, messages" disabled="{!reportee.Certification_Status__c != 'Pending'}">
                        <apex:param name="recordId" value="{!reportee.Id}" assignTo="{!selectedRecordId}" />
                    </apex:commandButton>
                </apex:column>
            </apex:pageBlockTable>
        </apex:pageBlock>
    </apex:form>
</apex:page>